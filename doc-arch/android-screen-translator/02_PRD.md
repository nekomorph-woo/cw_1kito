# Product Requirements Document (PRD)

**Document Version:** 1.1
**Last Updated:** 2025-02-10
**Status:** DRAFT

---

## 1. Product Vision

### 1.1 Vision Statement

构建一款基于 Android 平台的全局屏幕翻译应用，利用多模态大模型的视觉和自然语言处理能力，实现"一点即译"的无缝跨语言阅读体验。

### 1.2 Value Proposition

| 特性 | 价值 |
|------|------|
| **一键即时翻译** | 无需切换应用、复制粘贴，单击悬浮球即可获取全屏翻译 |
| **原位覆盖展示** | 翻译结果直接覆盖在原文位置，保留视觉上下文 |
| **多模态智能识别** | 利用大模型同时完成 OCR 和翻译，一步到位 |
| **多语言支持** | 支持中/英/日/韩等多种语言，自动识别源语言 |
| **全局可用** | 悬浮窗可在任意应用之上工作 |

---

## 2. Problem Statement

### 2.1 Current State

现有翻译解决方案存在以下问题：

1. **传统翻译应用**：需要用户手动复制文本，切换到翻译应用，粘贴后才能获取翻译
2. **图片翻译工具**：通常需要拍照或选择相册图片，无法直接翻译屏幕内容
3. **OCR + 翻译分离**：需要两次操作，且翻译结果无法在原位置展示
4. **上下文丢失**：翻译结果脱离了原文的视觉环境

### 2.2 Pain Points

| Pain Point | Description | Impact |
|------------|-------------|--------|
| **P1** | 阅读外文游戏界面时频繁切换字典 | 打断阅读体验 |
| **P2** | 看漫画/读图时无法快速理解外文内容 | 需要额外工具 |
| **P3** | 语言学习者需要即时翻译辅助 | 现有方案效率低 |
| **P4** | 商务人士需要快速理解外文信息 | 时间成本高 |

### 2.3 Impact

不解决这些问题将导致：
- 用户阅读外文内容的体验持续低效
- 语言学习和跨语言交流存在障碍
- 移动设备的多语言潜力未充分利用

---

## 3. User Personas

### 3.1 Primary Users

| Persona | Description | Goals | Pain Points |
|---------|-------------|-------|-------------|
| **语言学习者** | 学习外语的学生或自学者 | 快速理解生词，辅助学习 | 查词频繁，打断阅读 |
| **游戏玩家** | 玩外文游戏的玩家 | 理解游戏剧情和界面 | 无法翻译游戏内文本 |
| **商务人士** | 阅读外文资料的专业人士 | 快速获取信息 | 时间紧迫，需要高效工具 |
| **漫画读者** | 阅读原版漫画的用户 | 理解对话内容 | 图片中的文字难以翻译 |

---

## 4. User Stories

### 4.1 Core Features

| ID | User Story | Priority |
|----|------------|----------|
| **US-001** | 作为用户，我想要配置默认翻译语言，以便快速获得我需要的翻译结果 | P0 |
| **US-002** | 作为用户，我想要点击悬浮球后自动翻译屏幕内容，以便无需手动操作 | P0 |
| **US-003** | 作为用户，我想要翻译结果显示在原文位置，以便保持上下文 | P0 |
| **US-004** | 作为用户，我想要拖拽悬浮球到合适位置，以免遮挡重要内容 | P0 |
| **US-005** | 作为用户，我想要自动识别源语言，以便无需手动选择 | P1 |

### 4.2 Secondary Features

| ID | User Story | Priority |
|----|------------|----------|
| **US-101** | 作为用户，我想要查看原文和译文对比，以便学习对照 | P1 |
| **US-102** | 作为用户，我想要复制翻译结果，以便在其他地方使用 | P1 |
| **US-103** | 作为用户，我想要自定义悬浮球样式，以便个性化体验 | P2 |
| **US-104** | 作为用户，我想要查看翻译历史，以便回顾之前的内容 | P2 |

---

## 5. Functional Requirements

### 5.1 Must Have Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| **FR-001** | 应用必须能够请求并获得悬浮窗权限 (SYSTEM_ALERT_WINDOW) | P0 |
| **FR-002** | 应用必须能够请求并获得屏幕录制权限 (MediaProjection) | P0 |
| **FR-003** | 应用必须实现前台服务以保持后台运行 | P0 |
| **FR-004** | 应用必须实现可拖拽的悬浮球图标 | P0 |
| **FR-005** | 应用必须能够截取当前屏幕内容 | P0 |
| **FR-006** | 应用必须能够将截图发送到云端大模型 API | P0 |
| **FR-007** | 应用必须能够解析 API 返回的 JSON 数据（坐标+原文+译文） | P0 |
| **FR-008** | 应用必须能够在屏幕上绘制白色背景矩形框 | P0 |
| **FR-009** | 应用必须能够在矩形框内绘制翻译文本 | P0 |
| **FR-010** | 应用必须支持源语言和目标语言配置 | P0 |

### 5.2 Should Have Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| **FR-101** | 应用应该支持自动识别源语言 | P1 |
| **FR-102** | 应用应该在处理过程中显示加载动画 | P1 |
| **FR-103** | 应用应该处理网络错误并显示友好提示 | P1 |
| **FR-104** | 应用应该支持多组文本同时识别和展示 | P1 |
| **FR-105** | 应用应该支持点击覆盖层关闭翻译结果 | P1 |

### 5.3 Could Have Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| **FR-201** | 应用可以支持离线缓存翻译结果 | P2 |
| **FR-202** | 应用可以支持翻译历史记录 | P2 |
| **FR-203** | 应用可以支持自定义悬浮球样式 | P2 |
| **FR-204** | 应用可以支持原文/译文切换显示 | P2 |

---

## 6. Non-Functional Requirements

### 6.1 Performance

| Metric | Target | Measurement |
|--------|--------|-------------|
| 端到端延迟 | < 5 秒 | 从点击悬浮球到显示翻译结果 |
| 悬浮球响应时间 | < 100ms | 从点击到视觉反馈 |
| 内存占用 | < 150MB | 服务运行时内存使用 |
| 应用大小 | < 50MB | APK 安装包大小 |

### 6.2 Security

- 截图数据不得在本地持久化存储
- API Key 应安全存储（使用 Android Keystore）
- 传输数据应使用 HTTPS 加密
- 不得收集用户个人信息

### 6.3 Scalability

- 应用应支持不同屏幕尺寸（手机/平板）
- 应用应适配不同分辨率（720p - 4K）
- 应用应支持 Android 7.0 及以上版本

### 6.4 Compatibility

| Platform | Versions |
|----------|----------|
| Android | API 24 - API 36 |
| 架构 | ARM64, ARMv7 |

### 6.5 Maintainability

- 代码遵循 Kotlin 官方编码规范
- 核心业务逻辑与平台特定代码分离
- 提供充分的代码注释和文档

---

## 7. User Interface Requirements

### 7.1 Design Principles

- **简洁优先**: 界面元素少而精
- **响应迅速**: 所有交互应有即时反馈
- **非侵入式**: 悬浮元素应最小化对原内容的遮挡

### 7.2 Key Screens

| Screen | Description | Key Elements |
|--------|-------------|--------------|
| **主设置界面** | 配置语言和 API | 语言选择器、API Key 输入、启动按钮 |
| **悬浮球** | 全局可用的触发器 | 圆形图标、可拖拽 |
| **加载状态** | 处理中的反馈 | 进度动画、状态文本 |
| **翻译覆盖层** | 显示翻译结果 | 白色矩形框、翻译文本 |

### 7.3 Accessibility

- 支持系统字体缩放
- 提供足够的点击区域（最小 48dp）
- 颜色对比度符合 WCAG AA 标准

---

## 8. Data & Privacy

### 8.1 Data Collection

| Data Type | Purpose | Retention |
|-----------|---------|-----------|
| 截图数据 | 发送给大模型进行 OCR 和翻译 | 使用后立即销毁 |
| 语言配置 | 保存用户偏好设置 | 本地存储 |
| API Key | 调用云端 API（用户自备） | 本地加密存储 |

### 8.2 Privacy Requirements

- 截图数据仅用于翻译，不用于其他目的
- 截图数据不在本地保存，使用后立即从内存中清除
- 不收集用户使用行为数据
- 遵守 GDPR 和相关隐私法规
- API Key 由用户自行提供并管理

---

## 9. Success Metrics

### 9.1 Key Performance Indicators

| Metric | Target | Timeline |
|--------|--------|----------|
| 翻译准确率 | > 90% | 用户满意度调查 |
| 功能完成率 | 100% 核心功能 | MVP 发布 |
| 崩溃率 | < 1% | 生产环境 |
| 平均会话时长 | > 5 分钟 | 用户留存 |

### 9.2 Definition of Done

- [ ] 所有 P0 功能需求实现并通过测试
- [ ] 通过 Android 兼容性测试
- [ ] 完成安全审查
- [ ] 用户文档完成
- [ ] 发布到应用商店（内测或公测）

---

## 10. Assumptions & Constraints

### 10.1 Assumptions

- 用户设备具有稳定的网络连接
- 用户愿意授予悬浮窗和录屏权限
- 云端大模型 API 稳定可用
- 用户具备基本的 Android 应用使用经验

### 10.2 Constraints

- Android 系统对悬浮窗的限制
- 每次启动录屏需要用户确认
- 大模型 API 的调用频率限制
- 设备性能和电池消耗限制
- **商业模式**: 个人开发，用户自备 API Key

---

## 11. Risks & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| 系统杀死后台服务 | 高 | 中 | 使用前台服务，引导用户关闭电池优化 |
| 坐标映射不准确 | 中 | 中 | 实现容错机制，坐标验证和扩展 |
| 用户拒绝授权权限 | 高 | 低 | 提供清晰的权限说明和引导 |
| API 配置错误 | 中 | 中 | 提供 API Key 验证功能 |

---

## 12. Open Questions

| ID | Question | Priority |
|----|----------|----------|
| **Q-001** | 如何实现坐标偏差容错机制？ | P1 |
| **Q-002** | 文字排版的适应性方案如何实现？ | P1 |
| **Q-003** | 是否需要支持离线模式？ | P2 |

---

## Appendix

### A. Glossary

| Term | Definition |
|------|------------|
| OCR | 光学字符识别，从图像中提取文本 |
| MediaProjection | Android API，用于截取屏幕内容 |
| 悬浮窗 | 显示在其他应用之上的窗口 |
| 归一化坐标 | 将坐标转换为 0-1 范围，便于适配不同分辨率 |
| 多模态大模型 | 同时支持图像和文本输入的 AI 模型 |

### B. References

- 安卓翻译app功能需求分析.md
- Android MediaProjection API 文档
- Kotlin Multiplatform 官方文档
